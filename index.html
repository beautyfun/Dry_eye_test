<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>乾眼症檢測</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <div id="loading" class="text-center p-10">
        <p class="text-lg text-gray-600">問卷載入中...</p>
    </div>

    <div id="quiz-container" class="max-w-md w-full mx-auto bg-white rounded-2xl shadow-lg p-6 sm:p-8 hidden">
        <h1 class="text-2xl font-bold text-gray-800 mb-2 text-center">乾眼症自我檢測</h1>
        <p class="text-center text-gray-500 mb-6">請依據您最近一週的狀況回答</p>

        <!-- 問題 1 -->
        <div class="mb-6">
            <p class="font-semibold text-gray-700 mb-3">1. 你是否經常感到眼睛乾澀或有異物感？</p>
            <div id="q1" class="space-y-2">
                <button data-value="0" class="option-btn w-full text-left p-3 rounded-lg border-2 border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition">經常</button>
                <button data-value="1" class="option-btn w-full text-left p-3 rounded-lg border-2 border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition">偶爾</button>
                <button data-value="2" class="option-btn w-full text-left p-3 rounded-lg border-2 border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition">很少</button>
                <button data-value="3" class="option-btn w-full text-left p-3 rounded-lg border-2 border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition">從不</button>
            </div>
        </div>

        <!-- 問題 2 -->
        <div class="mb-6">
            <p class="font-semibold text-gray-700 mb-3">2. 長時間使用電腦或手機後，眼睛是否感到疲勞？</p>
            <div id="q2" class="space-y-2">
                <button data-value="0" class="option-btn w-full text-left p-3 rounded-lg border-2 border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition">總是</button>
                <button data-value="1" class="option-btn w-full text-left p-3 rounded-lg border-2 border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition">經常</button>
                <button data-value="2" class="option-btn w-full text-left p-3 rounded-lg border-2 border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition">偶爾</button>
                <button data-value="3" class="option-btn w-full text-left p-3 rounded-lg border-2 border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition">從不</button>
            </div>
        </div>

        <!-- 問題 3 -->
        <div class="mb-6">
            <p class="font-semibold text-gray-700 mb-3">3. 你的眼睛是否容易流淚或有灼熱感？</p>
            <div id="q3" class="space-y-2">
                <button data-value="0" class="option-btn w-full text-left p-3 rounded-lg border-2 border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition">經常</button>
                <button data-value="1" class="option-btn w-full text-left p-3 rounded-lg border-2 border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition">有時候</button>
                <button data-value="2" class="option-btn w-full text-left p-3 rounded-lg border-2 border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition">很少</button>
                <button data-value="3" class="option-btn w-full text-left p-3 rounded-lg border-2 border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition">沒有</button>
            </div>
        </div>
        
        <!-- 問題 4 -->
        <div class="mb-6">
            <p class="font-semibold text-gray-700 mb-3">4. 早晨起床時，眼睛是否感到特別乾澀？</p>
            <div id="q4" class="space-y-2">
                <button data-value="0" class="option-btn w-full text-left p-3 rounded-lg border-2 border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition">每天都會</button>
                <button data-value="1" class="option-btn w-full text-left p-3 rounded-lg border-2 border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition">經常</button>
                <button data-value="2" class="option-btn w-full text-left p-3 rounded-lg border-2 border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition">偶爾</button>
                <button data-value="3" class="option-btn w-full text-left p-3 rounded-lg border-2 border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition">從不</button>
            </div>
        </div>

        <button id="submit-btn" class="w-full bg-blue-500 text-white font-bold py-4 px-6 rounded-xl mt-4 transition hover:bg-blue-600 disabled:bg-gray-400 disabled:cursor-not-allowed">
            查看結果
        </button>
    </div>

<script>
    // --- 兩個需要您手動替換的變數 ---
    const MY_LIFF_ID = "2008525178-vkngreY2"; // 等下從 LINE Console 複製
    const MAKE_WEBHOOK_URL = "YOUR_MAKE_WEBHOOK_URL_HERE"; // 等下從 Make.com 複製

    const answers = {};
    const totalQuestions = 4;

    document.addEventListener('DOMContentLoaded', function () {
        liff.init({ liffId: MY_LIFF_ID })
            .then(() => {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('quiz-container').classList.remove('hidden');
            })
            .catch((err) => { console.error(err); });

        document.querySelectorAll('.option-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const group = btn.parentElement;
                group.querySelectorAll('.option-btn').forEach(b => b.classList.remove('bg-blue-100', 'border-blue-500', 'font-bold'));
                btn.classList.add('bg-blue-100', 'border-blue-500', 'font-bold');
                answers[group.id] = parseInt(btn.dataset.value, 10);
                
                // 檢查是否所有問題都回答了
                if (Object.keys(answers).length === totalQuestions) {
                    document.getElementById('submit-btn').disabled = false;
                }
            });
        });
        
        document.getElementById('submit-btn').disabled = true; // 預設禁用
        document.getElementById('submit-btn').addEventListener('click', submitAnswers);
    });

    async function submitAnswers() {
        const submitBtn = document.getElementById('submit-btn');
        submitBtn.textContent = '分析中...';
        submitBtn.disabled = true;

        try {
            const profile = await liff.getProfile();
            const data = {
                userId: profile.userId,
                scores: Object.values(answers)
            };

            await fetch(MAKE_WEBHOOK_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data),
            });
            
            liff.closeWindow();
        } catch (error) {
            alert("提交失敗，請稍後再試");
            submitBtn.textContent = '查看結果';
            submitBtn.disabled = false;
        }
    }
</script>
</body>
</html>
